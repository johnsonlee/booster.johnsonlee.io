# Release æ„å»ºä¾èµ–æ£€æŸ¥

*APP* åœ¨æ—¥å¸¸çš„ç‰ˆæœ¬å‘å¸ƒä¸­ï¼Œéš¾å…å› ä¸ºæŸäº›åŸå› è¦å›æ»šç‰ˆæœ¬ï¼Œå°½ç®¡å‘å¸ƒä¹‹å‰ä¼šåœ¨ *Git* ä¸Šæ‰“ *Tag*ï¼Œå›æ»šåˆ°åŸæ¥çš„ *Tag* ï¼Œå³ä½¿åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä¹Ÿæœªå¿…èƒ½æ„å»ºå‡ºè·ŸåŸæ¥ä¸€æ¨¡ä¸€æ ·çš„ *APK*ï¼Œå…¶ä¸­ï¼Œå½±å“å›æ»šçš„å¾ˆé‡è¦çš„ä¸€ä¸ªåŸå› æ˜¯ä¾èµ–çš„ç‰ˆæœ¬ç®¡ç†ã€‚ä¸ºä»€ä¹ˆä¾èµ–çš„ç‰ˆæœ¬ç®¡ç†å¦‚æ­¤é‡è¦å‘¢ï¼Ÿè¿™å¾—ä»ä¸€ä¸ªæ•…äº‹è¯´èµ·ã€‚

> æŸ *APP* åœ¨ä¸Šä¸€ä¸ªç‰ˆæœ¬ *v1.2.0* ä¸­ä¾èµ–äº† *libsecurity* åº“ï¼Œç‰ˆæœ¬å·ä¸º *1.0.0-SNAPSHOT*ï¼Œæ¥ä¸‹æ¥ï¼Œ*APP* è¦å‘å¸ƒ *v1.3.0*ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¾èµ–äº† *libsecurity* åº“çš„ *1.0.1-SNAPSHOT* ç‰ˆæœ¬ï¼Œç»è¿‡ç°åº¦å‘å¸ƒåï¼Œæœªè§æ˜æ˜¾å¼‚å¸¸ï¼Œäºæ˜¯å¼€å§‹å…¨é‡å‘å¸ƒï¼Œç»“æœï¼Œåœ¨æ”¾é‡çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ‰ä¸ªæ–°å¢çš„å´©æºƒé™¡å¢ï¼Œç»æ’æŸ¥å‘ç°ï¼Œæ˜¯ç”±äº *libsecurity* åº“ä¸­çš„åŠ¨æ€åº“å¯¼è‡´ï¼Œå› æ­¤ä¸å¾—ä¸å°† *libsecurity* åº“çš„ç‰ˆæœ¬å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ â€”â€” *1.0.0-SNAPSHOT*ï¼Œå›æ»šåç°åº¦ä¾ç„¶æœªå‘ç°é—®é¢˜ï¼Œæ¥ç€å¼€å§‹å…¨é‡ï¼Œåœ¨å…¨é‡çš„è¿‡ç¨‹ï¼Œåˆå‘ç°äº†è·Ÿä¹‹å‰ä¸€æ ·çš„å´©æºƒã€‚

æ•…äº‹åˆ°è¿™å„¿ï¼Œå¯èƒ½æœ‰äººå°±ä¼šé—®äº†ï¼Œä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸æ˜¯æ²¡é—®é¢˜ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå›æ»šç‰ˆæœ¬äº†ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­å‡ºç°çš„å´©æºƒä¸ºä»€ä¹ˆä¼šå‡ºç°åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Ÿ

ç»è¿‡æ’æŸ¥å‘ç°ï¼ŒåŸæ¥æ˜¯ *libsecurity* åº“çš„ç»´æŠ¤è€…å°† *1.0.1-SNAPSHOT* ä¸­çš„ *feature* ä»¥ *1.0.0-SNAPSHOT* çš„ç‰ˆæœ¬å·å‘å¸ƒåˆ°äº† *Maven* ä»“åº“ä¸­ï¼Œå¯¼è‡´åŸæ¥çš„ *1.0.0-SNAPSHOT* æ··å…¥äº†æ–°çš„ä»£ç ï¼Œæ‰€ä»¥ï¼Œå³ä½¿å›æ»šåˆ°äº†åŸæ¥çš„ç‰ˆæœ¬ï¼Œé—®é¢˜ä¾ç„¶è¿˜å­˜åœ¨ã€‚

## è§£å†³æ–¹æ¡ˆ

ä½†å¹³å¸¸çš„å¼€å‘è¿­ä»£ä¸­ï¼Œå¦‚æœ *Code Review* ä¸å¤Ÿä»”ç»†ï¼Œå°±å®¹æ˜“å‡ºç°ä¸Šé¢çš„æƒ…å†µï¼Œå°† *SNAPSHOT* ç‰ˆæœ¬å¸¦åˆ°çº¿ä¸Šï¼Œä¸ºäº†æ–¹ä¾¿çš„è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ*Booster* æä¾›äº† [booster-task-check-snapshot](https://github.com/didi/booster/blob/master/booster-task-check-snapshot) æ¨¡å—ï¼Œç”¨äºå¯¹ *Release* æ„å»ºçš„ä¾èµ–åº“ç‰ˆæœ¬è¿›è¡Œæ£€æŸ¥ï¼Œé¿å…ä¾èµ– *SNAPSHOT* ç‰ˆæœ¬çš„åº“ï¼š

```kotlin
internal open class CheckSnapshot : DefaultTask() {

    lateinit var variant: BaseVariant

    @TaskAction
    fun run() {
        if (!variant.buildType.isDebuggable) {
            variant.dependencies.filter {
                it.id.componentIdentifier is MavenUniqueSnapshotComponentIdentifier
            }.map {
                it.id.componentIdentifier as MavenUniqueSnapshotComponentIdentifier
            }.ifNotEmpty { snapshots ->
                println("$CSI_YELLOW âš ï¸  ${snapshots.size} SNAPSHOT artifacts found in ${variant.name} variant:$CSI_RESET\n${snapshots.joinToString("\n") { snapshot -> "$CSI_YELLOWâ†’  ${snapshot.displayName}$CSI_RESET" }}")
            }
        }
    }

}
```

## å¦‚ä½•ä½¿ç”¨

å¯ç”¨ *SNAPSHOT* æ£€æŸ¥åªéœ€è¦åœ¨æ ¹å·¥ç¨‹çš„ *build.gradle* ä¸­å¼•å…¥ [booster-task-check-snapshot](https://github.com/didi/booster/blob/master/booster-task-check-snapshot) æ¨¡å—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```groovy
buildscript {
    ext {
        kotlin_version = '1.3.31'
        booster_version = '4.3.0'
    }
    repositories {
        mavenLocal()
        mavenCentral()
        google()
        jcenter()
        maven { url 'https://oss.sonatype.org/content/repositories/public/' }
        maven { url 'https://oss.sonatype.org/content/repositories/snapshots/' }
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.5.0'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "com.didiglobal.booster:booster-gradle-plugin:$booster_version"

        /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ å¼•ç”¨è¿™ä¸ªæ¨¡å— ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
        classpath "com.didiglobal.booster:booster-task-check-snapshot:$booster_version"
    }
}
```

ç„¶åï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `checkSnapshot` ä»»åŠ¡ï¼š

```bash
$ ./gradlew checkSnapshot
```
